
# ะะฐัะฟัะตะดะตะปัะฝะฝัะน ะฒััะธัะปะธัะตะปั ะฐัะธัะผะตัะธัะตัะบะธั ะฒััะฐะถะตะฝะธะน (Calc_2GO)

## ะะฟะธัะฐะฝะธะต ะฟัะพะตะบัะฐ
ะะฐัะฟัะตะดะตะปัะฝะฝะฐั ัะธััะตะผะฐ ะดะปั ะฒััะธัะปะตะฝะธั ะฐัะธัะผะตัะธัะตัะบะธั ะฒััะฐะถะตะฝะธะน ั:
- ะะฝะพะณะพะฟะพะปัะทะพะฒะฐัะตะปััะบะธะผ ัะตะถะธะผะพะผ (JWT ะฐััะตะฝัะธัะธะบะฐัะธั)
- ะะตััะธััะตะฝัะฝัะผ ััะฐะฝะตะฝะธะตะผ ะฒ SQLite
- gRPC ะฒะทะฐะธะผะพะดะตะนััะฒะธะตะผ ะผะตะถะดั ะบะพะผะฟะพะฝะตะฝัะฐะผะธ
- ะะฒัะพะผะฐัะธัะตัะบะธะผ ัะฐัะฟัะตะดะตะปะตะฝะธะตะผ ะทะฐะดะฐั ะผะตะถะดั ะฐะณะตะฝัะฐะผะธ
- ะะพะดะดะตัะถะบะพะน ัะปะพะถะฝัั ะฒััะฐะถะตะฝะธะน ัะพ ัะบะพะฑะบะฐะผะธ ะธ ะฟัะธะพัะธัะตัะฐะผะธ ะพะฟะตัะฐัะธะน

**ะะปััะตะฒัะต ะพัะพะฑะตะฝะฝะพััะธ:**
- ะกะพััะฐะฝะตะฝะธะต ัะพััะพัะฝะธั ะฟัะธ ะฟะตัะตะทะฐะฟััะบะต
- ะะฐัะฐะปะปะตะปัะฝะฐั ะพะฑัะฐะฑะพัะบะฐ ะทะฐะดะฐั
- ะะฐัััะฐะธะฒะฐะตะผะฐั ะฟัะพะธะทะฒะพะดะธัะตะปัะฝะพััั ะฐะณะตะฝัะพะฒ
- ะะพะดัะพะฑะฝะพะต ะปะพะณะธัะพะฒะฐะฝะธะต ะฒัะตั ะพะฟะตัะฐัะธะน

## ะกัััะบัััะฐ ะฟัะพะตะบัะฐ
* CALC_2GO/
* โโโ api/                        # Protobuf ะธ gRPC ัะฐะนะปั
* โ   โโโ calculator_grpc.pb.go
* โ   โโโ calculator.pb.go
* โ   โโโ calculator.proto
* โโโ cmd/
* โ   โโโ agent/                  # ะะณะตะฝั
* โ   โ   โโโ main.go             # ะขะพัะบะฐ ะฒัะพะดะฐ ะดะปั ะฐะณะตะฝัะฐ
* โ   โโโ orchestrator/           # ะัะบะตัััะฐัะพั
* โ       โโโ main.go             # ะขะพัะบะฐ ะฒัะพะดะฐ ะดะปั ะพัะบะตัััะฐัะพัะฐ
* โโโ internal/
* โ   โโโ agent/                  # ะะพะณะธะบะฐ ะฐะณะตะฝัะฐ
* โ   โ   โโโ agent.go
* โ   โ   โโโ agent_test.go
* โ   โโโ orchestrator/           # ะะพะณะธะบะฐ ะพัะบะตัััะฐัะพัะฐ
* โ       โโโ orchestrator.go
* โ       โโโ storage.go
* โ       โโโ tests/
* โ           โโโ integration_test.go
* โ           โโโ module_test.go
* โโโ models/                     # ะะพะดะตะปะธ ะดะฐะฝะฝัั
* โ   โโโ models.go
* โโโ pkg/
* โ   โโโ calculator/             # ะะพะณะธะบะฐ ะฒััะธัะปะตะฝะธะน
* โ       โโโ calculator.go
* โ       โโโ calculator_test.go
* โโโ .gitignore                  # ะะณะฝะพัะธััะตะผัะต ัะฐะนะปั
* โโโ go.mod                      # ะคะฐะนะป ะผะพะดัะปั Go
* โโโ go.sum
* โโโ README.md


## ะะฐะฟััะบ ะฟัะพะตะบัะฐ

### 1. ะฃะฑะตะดะธัะตัั, ััะพ ั ะฒะฐั ัััะฐะฝะพะฒะปะตะฝะฐ ะฒะตััะธั Go 1.23 ะธะปะธ ะฒััะต.
ะั ะผะพะถะตัะต ัะบะฐัะฐัั ะธ ัััะฐะฝะพะฒะธัั Go ั [ะพัะธัะธะฐะปัะฝะพะณะพ ัะฐะนัะฐ](https://go.dev/dl/).

**ะขัะตะฑะพะฒะฐะฝะธั:**
- Go 1.20+
- SQLite3
- gRPC

### 2. ะะปะพะฝะธััะนัะต ัะตะฟะพะทะธัะพัะธะน:
```bash
https://github.com/A6ra-Kada6ra/...
```
### 3. ะะตัะตะนะดะธัะต ะฒ ะฟะฐะฟะบั ะฟัะพะตะบัะฐ:
```bash
  cd <ะฟััั_ะบ_ะฟัะพะตะบัั>
```
### 4. ะฃััะฐะฝะพะฒะธัะต ะทะฐะฒะธัะธะผะพััะธ:
```bash
  go mod tidy
```

### 5. ะะฐะฟััะบะฐะตะผ ะพัะบะตัััะฐัะพั:
```bash
go run cmd/orchestrator/main.go
```
### 6. ะะพัะปะต ััะฟะตัะฝะพะณะพ ะทะฐะฟััะบะฐ ะฒ ะบะพะฝัะพะปะธ ะฒััะฒะตัะธัััั ัะปะตะดัััะตะต ัะพะพะฑัะตะฝะธะต:
```bash
๐๏ธ ะะฐะฟััะบ ะพัะบะตัััะฐัะพัะฐ...
๐ข HTTP ัะตัะฒะตั ะทะฐะฟััะตะฝ ะฝะฐ :8080
๐ข gRPC ัะตัะฒะตั ะทะฐะฟััะตะฝ ะฝะฐ :50051
Database initialized successfully
``` 

### 7.  ะัะบัะพะนัะต ะฝะพะฒัะน ัะตัะผะธะฝะฐะป (ะฝะต ะทะฐะบััะฒะฐั ะฟัะตะดัะดััะธะน) ะธ ะทะฐะฟัััะธัะต ะฐะณะตะฝั:
```bash
go run cmd/agent/main.go
```
### 8. ะะพัะปะต ััะฟะตัะฝะพะณะพ ะทะฐะฟััะบะฐ ะฒ ะบะพะฝัะพะปะธ ะฒััะฒะตัะธัััั ัะปะตะดัััะตะต ัะพะพะฑัะตะฝะธะต:
```bash
 ะะณะตะฝั ะทะฐะฟััะตะฝ, ะฟะพะดะบะปััะฐะตััั ะบ ะพัะบะตัััะฐัะพัั ะฟะพ ะฐะดัะตัั: localhost:50051
๐ ะะฐะฟััะบ ะฐะณะตะฝัะฐ...
```

# ะคะพัะผะฐั ะทะฐะฟัะพัะฐ
1. ะะพะฑะฐะฒะปะตะฝะธะต ะฒััะฐะถะตะฝะธั ะดะปั ะฒััะธัะปะตะฝะธั
ะะฐะฟัะพั ะดะพะปะถะตะฝ ัะพะดะตัะถะฐัั JSON ะพะฑัะตะบั ัะพ ัะปะตะดัััะตะน ััััะบัััะพะน:

## ะัะธะผะตั ะทะฐะฟัะพัะฐ 
1. ะะตะณะตัััะฐัะธั ะฟะพะปัะทะพะฒะฐัะตะปั:
```bash
curl -X POST "http://localhost:8080/api/v1/register" \
-H "Content-Type: application/json" \
-d '{"login":"user1","password":"MySecurePass123"}'
```
## ะฃัะฟะตัะฝัะน ะพัะฒะตั (200 OK):

``` json
{
  "status":"ะะพะปัะทะพะฒะฐัะตะปั ัะพะทะดะฐะฝ"
}
```
ะัะปะธ ะฒั ะทะฐะฟััะบะฐะตั ะฟัะพะณัะฐะผะผั ะฒะพ ะฒัะพัะพะน ัะฐะท ะธ ัะถะต ัะตะณะตัััะพะฒะฐะปะธัั, ะธะปะธ ัะพะทะดะฐะปะธ ะฟะตัะฒัะน ะฐะบะฐัะฝั ะธ ะฟะพะด ัะตะผะต ะถะต ะดะฐะฝะฝัะผะธ ัะพะฑะธัะฐะตัะตัั ัะพะทะดะฐัั ะฝะพะฒัะน ะฒั ะฟะพะปััะธัะต ะพัะธะฑะบั.
## ะัะธะฑะบะฐ (409 Conflict):
``` json
{
   "error":"ะะพะปัะทะพะฒะฐัะตะปั ัะถะต ัััะตััะฒัะตั"
  }
```
2. ะััะตะฝัะธัะธะบะฐัะธั

## ะัะธะผะตั ะทะฐะฟัะพัะฐ:
```bash
curl -X POST "http://localhost:8080/api/v1/login" \
-H "Content-Type: application/json" \
-d '{"login":"user1","password":"MySecurePass123"}'
```
## ะฃัะฟะตัะฝัะน ะพัะฒะตั (200 OK):
``` json
{
   "token":"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9..."
  }
```
ะัะปะธ ะฒั ััะพ-ัะพ ะฒะฒะตะปะธ ะฝะตะฟัะฐะฒะธะปัะฝะพ (ะปะพะณะธะฝ ะธะปะธ ะฟะฐัะพะปั)ัะพ ัะฒะธะดะธัะต ะพัะธะฑะบั:
## ะัะธะฑะบะฐ (401 Unauthorized):
``` json
{
   "error":"ะะตะฒะตัะฝัะต ััะตัะฝัะต ะดะฐะฝะฝัะต"
  }
```

3. ะะพะฑะฐะฒะปะตะฝะธะต ะฒััะฐะถะตะฝะธั

## ะัะธะผะตั ะทะฐะฟัะพัะฐ:
```bash
curl -X POST http://localhost:8080/api/v1/calculate -H "Content-Type: application/json" -H "Authorization: Bearer YOUR_TOKEN" -d "{\"expression\":\"(2+3)*4-10/2\"}"
```
## ะฃัะฟะตัะฝัะน ะพัะฒะตั (201 Created):
``` json
{
  "id":"1"
}
```
ะฒ ัะปััะฐะต ะฝะตะฒะตัะฝะพะณะพ ะฒะฒะพะดะฐ ะฒััะฐะถะตะฝะธั ะฒั ะฟะพะปััะธัะต ะพัะธะฑะบั.
## ะัะธะฑะบะฐ (422 Unprocessable Entity):
``` json
{
  "error":"ะะตะบะพััะตะบัะฝะพะต ะฒััะฐะถะตะฝะธะต: ะฝะตะพะถะธะดะฐะฝะฝัะน ัะธะผะฒะพะป 'a'"
}
```
## ะัะธะฑะบะฐ (400 Bad Request):
``` json
{
  "error":"ะะตะฒะตัะฝัะน ัะพัะผะฐั ะทะฐะฟัะพัะฐ"
}
```

4. ะัะพะฒะตัะบะฐ ััะฐัััะฐ ะฒััะฐะถะตะฝะธั

## ะัะธะผะตั ะทะฐะฟัะพัะฐ:
```bash
curl http://localhost:8080/api/v1/expressions -H "Authorization: Bearer YOUR_TOKEN"
```
## ะะถะธะดะฐะตะผัะน ะพัะฒะตั:
1. ะัะปะธ ะฟัะพะณัะฐะผะผ ะตัะต ะฝะต ัะตัะธะปะฐ:โฌ๏ธ
``` json
}
 "id":1,"user_id":1,"expression":"(2+3)*4-10/2","status":"progress","result":
}
``` json
}
 "id":1,"user_id":1,"expression":"(2+3)*4-10/2","status":"done","result":15
}
```
2. ะัะธ ััะฟะตัะฝะพะผ ัะตัะตะฝะธะธ: โฌ๏ธ
## ะัะธะฑะบะฐ (404 Not Found):
```bash
"error":"ะััะฐะถะตะฝะธะต ะฝะต ะฝะฐะนะดะตะฝะพ"
```

## ะะณัะฐะฝะธัะตะฝะธั ะธ ััะตะฑะพะฒะฐะฝะธั ะบ ะทะฐะฟัะพัั

ะะฐะปัะบัะปััะพั ะธะผะตะตั ัะปะตะดัััะธะต ะพะณัะฐะฝะธัะตะฝะธั ะธ ััะตะฑะพะฒะฐะฝะธั ะบ ะฐัะธัะผะตัะธัะตัะบะธะผ ะฒััะฐะถะตะฝะธัะผ, ะบะพัะพััะต ะพะฝ ะผะพะถะตั ะพะฑัะฐะฑะฐััะฒะฐัั:

ะะพะดะดะตัะถะธะฒะฐะตะผัะต ะพะฟะตัะฐัะธะธ:
- ะกะปะพะถะตะฝะธะต (`+`)
- ะััะธัะฐะฝะธะต (`-`)
- ะฃะผะฝะพะถะตะฝะธะต (`*`)
- ะะตะปะตะฝะธะต (`/`)

ะัะพะฑะตะฝะฝะพััะธ ะพะฑัะฐะฑะพัะบะธ:
- ะะฐะปัะบัะปััะพั ะฟะพะดะดะตัะถะธะฒะฐะตั ะธัะฟะพะปัะทะพะฒะฐะฝะธะต ัะบะพะฑะพะบ ะดะปั ะทะฐะดะฐะฝะธั ะฟะพััะดะบะฐ ะพะฟะตัะฐัะธะน.
- ะะพะฟััะบะฐัััั ะฟัะพะฑะตะปั ะผะตะถะดั ะพะฟะตัะฐัะธัะผะธ ะธ ัะธัะปะฐะผะธ.
- ะงะธัะปะฐ ะผะพะณัั ะฑััั ัะตะปัะผะธ.

ะะณัะฐะฝะธัะตะฝะธั:
- ะะฐะฟัะพั ั ะฟััััะผ ะฒััะฐะถะตะฝะธะตะผ ะฟัะธะฒะตะดะตั ะบ ะพัะธะฑะบะต 422 (ะฝะตะบะพััะตะบัะฝะพะต ะฒััะฐะถะตะฝะธะต).
- ะะตะปะตะฝะธะต ะฝะฐ ะฝะพะปั ะฒัะทะพะฒะตั ะพัะธะฑะบั 422.
- ะะฐะปัะบัะปััะพั ะฝะต ะผะพะถะตั ะพะฑัะฐะฑะฐััะฒะฐัั:
  - ะะตัะธัะปะพะฒัะต ัะธะผะฒะพะปั (ะฝะฐะฟัะธะผะตั, ะฑัะบะฒั ะธะปะธ ัะฟะตัะธะฐะปัะฝัะต ัะธะผะฒะพะปั, ะพัะปะธัะฝัะต ะพั ัะฐะทัะตัะตะฝะฝัั ะพะฟะตัะฐัะธะน ะธ ัะบะพะฑะพะบ).
  - ะะตะฒะตัะฝะพะต ะธัะฟะพะปัะทะพะฒะฐะฝะธะต ัะบะพะฑะพะบ (ะฝะฐะฟัะธะผะตั, ะตัะปะธ ัะบะพะฑะบะธ ะฝะต ัะฑะฐะปะฐะฝัะธัะพะฒะฐะฝั).
  - ะกััะพะบะธ, ัะพะดะตัะถะฐัะธะต ะฑะพะปะตะต ะพะดะฝะพะณะพ ะพะฟะตัะฐัะพัะฐ ะฟะพะดััะด ะฑะตะท ะพะฟะตัะฐะฝะดะพะฒ (ะฝะฐะฟัะธะผะตั, `2++2`).

  * ะะณัะฐะฝะธัะตะฝะธั ะฒััะฐะถะตะฝะธะน
ะะฐัะฐะผะตัั	                  ะะฝะฐัะตะฝะธะต	                    ะัะธะผะตั ะพัะธะฑะบะธ
ะะฐะบัะธะผะฐะปัะฝะฐั ะดะปะธะฝะฐ	      100 ัะธะผะฒะพะปะพะฒ	          "ะกะปะธัะบะพะผ ะดะปะธะฝะฝะพะต ะฒััะฐะถะตะฝะธะต"
ะะปะพะถะตะฝะฝะพััั ัะบะพะฑะพะบ	      10 ััะพะฒะฝะตะน	           "ะกะปะธัะบะพะผ ะณะปัะฑะพะบะฐั ะฒะปะพะถะตะฝะฝะพััั"
ะะพะดะดะตัะถะธะฒะฐะตะผัะต ะพะฟะตัะฐัะธะธ	  +, -, *, /	             "ะะตะฟะพะดะดะตัะถะธะฒะฐะตะผะฐั ะพะฟะตัะฐัะธั ^"
ะคะพัะผะฐั ัะธัะตะป	           ะฆะตะปัะต ะธ ะดัะพะฑะฝัะต	          "ะะตะฒะตัะฝัะน ัะพัะผะฐั ัะธัะปะฐ: 2."


ะะพะดั ะพัะธะฑะพะบ
400 Bad Request - ะะตะฒะตัะฝัะน ัะพัะผะฐั ะทะฐะฟัะพัะฐ

401 Unauthorized - ะขัะตะฑัะตััั ะฐััะตะฝัะธัะธะบะฐัะธั

404 Not Found - ะะตัััั ะฝะต ะฝะฐะนะดะตะฝ

422 Unprocessable Entity - ะัะธะฑะบะฐ ะฒ ะฒััะฐะถะตะฝะธะธ

500 Internal Server Error - ะัะธะฑะบะฐ ัะตัะฒะตัะฐ


### ะะฐัััะพะนะบะฐ ะฒัะตะผะตะฝะธ ะฒัะฟะพะปะฝะตะฝะธั ะพะฟะตัะฐัะธะน
ะัะตะผั ะฒัะฟะพะปะฝะตะฝะธั ะพะฟะตัะฐัะธะน ะทะฐะดะฐะตััั ะฟะตัะตะผะตะฝะฝัะผะธ ััะตะดั ะฒ ะผะธะปะปะธัะตะบัะฝะดะฐั:

* TIME_ADDITION_MS โ ะฒัะตะผั ะฒัะฟะพะปะฝะตะฝะธั ะพะฟะตัะฐัะธะธ ัะปะพะถะตะฝะธั.

* TIME_SUBTRACTION_MS โ ะฒัะตะผั ะฒัะฟะพะปะฝะตะฝะธั ะพะฟะตัะฐัะธะธ ะฒััะธัะฐะฝะธั.

* TIME_MULTIPLICATION_MS โ ะฒัะตะผั ะฒัะฟะพะปะฝะตะฝะธั ะพะฟะตัะฐัะธะธ ัะผะฝะพะถะตะฝะธั.

* TIME_DIVISION_MS โ ะฒัะตะผั ะฒัะฟะพะปะฝะตะฝะธั ะพะฟะตัะฐัะธะธ ะดะตะปะตะฝะธั.

## ะัะธะผะตั ะฝะฐัััะพะนะบะธ:

```bash
export TIME_ADDITION_MS=1000
export TIME_SUBTRACTION_MS=1000
export TIME_MULTIPLICATION_MS=1000
export TIME_DIVISION_MS=1000
```
ะะฐัััะพะนะบะฐ ะฒััะธัะปะธัะตะปัะฝะพะน ะผะพัะฝะพััะธ ะฐะณะตะฝัะฐ
ะะพะปะธัะตััะฒะพ ะณะพัััะธะฝ (ะฒััะธัะปะธัะตะปัะฝัั ะผะพัะฝะพััะตะน) ะฐะณะตะฝัะฐ ัะตะณัะปะธััะตััั ะฟะตัะตะผะตะฝะฝะพะน ััะตะดั COMPUTING_POWER.

**ะัะธะผะตั ะฝะฐัััะพะนะบะธ:** 

```bash
export COMPUTING_POWER=2
```
ะขะตััะธัะพะฒะฐะฝะธะต
ะะปั ะทะฐะฟััะบะฐ ัะตััะพะฒ ะฒัะฟะพะปะฝะธัะต:

```bash
go test ./...
```
ะะฝัะตะณัะฐัะธะพะฝะฝัะต ัะตััั
```bash
cd internal/orchestrator/tests
go test -v -run TestIntegration
```
### ะดะธะฐะณัะฐะผะผะฐ:

```mermaid
sequenceDiagram
    participant ะะพะปัะทะพะฒะฐัะตะปั
    participant ะัะบะตัััะฐัะพั
    participant ะะณะตะฝั
    participant ะะฐะทะฐะะฐะฝะฝัั

    ะะพะปัะทะพะฒะฐัะตะปั->>ะัะบะตัััะฐัะพั: POST /calculate {expression}
    ะัะบะตัััะฐัะพั->>ะะฐะทะฐะะฐะฝะฝัั: ะกะพััะฐะฝะธัั ะฒััะฐะถะตะฝะธะต
    loop ะะพะบะฐ ะตััั ะทะฐะดะฐัะธ
        ะัะบะตัััะฐัะพั->>ะะณะตะฝั: gRPC: GetTask()
        ะะณะตะฝั->>ะะณะตะฝั: ะััะธัะปะตะฝะธะต
        ะะณะตะฝั->>ะัะบะตัััะฐัะพั: gRPC: SubmitResult()
        ะัะบะตัััะฐัะพั->>ะะฐะทะฐะะฐะฝะฝัั: ะะฑะฝะพะฒะธัั ััะฐััั
    end
    ะะพะปัะทะพะฒะฐัะตะปั->>ะัะบะตัััะฐัะพั: GET /expressions/{id}
    ะัะบะตัััะฐัะพั->>ะะพะปัะทะพะฒะฐัะตะปั: ะะพะทะฒัะฐัะฐะตั ัะตะทัะปััะฐั
    
```
